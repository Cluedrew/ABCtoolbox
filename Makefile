# Make file for the ABC Tool Box:
# Not currantly working, I'm working on it.

# See DevManual.txt for details.

# The names of all of the tools. Include any sub-directory of the CODEDIR
# that might contain them.
TOOLLIST= hello-world

# Compiler Varaibles:
CXX=gcc
CXXFLAGS=-Wall -MMD -std=c++11

# Is it possible to link in libraries ahead of time,
# As well as join the partally made objects together?
LINK=ld
LINKFLAGS=-Ur

# Directory names:
# Intermediate objects    (hide later, maybe make it "tmp")
INTDIR=obj
# Completed objects       (hide later)
OBJDIR=obj
# Completed libraries
LIBDIR=include
# Code Directory
CODEDIR=code

# Special Rules:
.PHONY : all
.SECONDEXPANSION :

# Internal Varaibles:
# Final objects, one step from a library. ???
FIN_OBJ=$(patsubst %,$(INTDIR)/$(TOOLLIST).o,?)
# All objects generated from code.
ALL_OBJ=$(sort $(suffix $(foreach tool,$(TOOLLIST),$(tool_OBJ)),.o))

# Functions:
# If given a list of tools (and optionally, the directory in CODEDIR that
# holdes them) will produce a list of final files used to create the tools.
endfiles= $(foreach base,$(foreach tool,$(1),$(notdir $(tool))),\
	$(LIBDIR)/$(base).hpp $(LIBDIR)/lib$(base).a)

### Rules:
all : $(call endfiles,$(TOOLLIST))

# Put the finished items into the include directory.
#$(TOOLLIST) : $(OBJDIR)/$$(notdir $$@).o $(CODEDIR)/$$@.hpp | $(LIBDIR)
#	ar rcs $(LIBDIR)/lib$@.a $(OBJDIR)/$(notdir $@).o
#	cp $(CODEDIR)/$@.hpp $(LIBDIR)/$(notdir $@).hpp

# Create the library in the include directory
$(LIBDIR)/lib%.a : $(OBJDIR)/$$(notdir $$(basename $$@)).o | $(LIBDIR)
	ar rcs $@ $<

# Copy the public header over. (shoot we lost the subdir information)
$(LIBDIR)/%.hpp

# Rule for final objects
# (objects generated by linking and are used to create libraries)
$(OBJDIR)/%.o :
#	$(LINK) $(LINKFLAGS) $^ $(object_LIB) -o $@

# Rule for intermediate objects:
# (all objects generated directly from code files)
$(ALL_OBJ) : $(patsubst $(TMPDIR)/%.o,$(CODEDIR)/%.cpp,$@) | $(TMPDIR)
	$(CXX) $(CXXFLAGS) -c $< -o $@

# Directory creation. Only INTDIR should ever have to be made.
$(INTDIR) $(OBJDIR) $(CODEDIR) $(LIBDIR) :
	mkdir $@



# Add dependancy files.
-include $(dependancy)

# clean phony rule.
clean :
